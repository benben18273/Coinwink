var DragDropTouch;!function(DragDropTouch_1){"use strict";var DataTransfer=function(){function DataTransfer(){this._dropEffect="move",this._effectAllowed="all",this._data={}}return Object.defineProperty(DataTransfer.prototype,"dropEffect",{get:function(){return this._dropEffect},set:function(value){this._dropEffect=value},enumerable:!0,configurable:!0}),Object.defineProperty(DataTransfer.prototype,"effectAllowed",{get:function(){return this._effectAllowed},set:function(value){this._effectAllowed=value},enumerable:!0,configurable:!0}),Object.defineProperty(DataTransfer.prototype,"types",{get:function(){return Object.keys(this._data)},enumerable:!0,configurable:!0}),DataTransfer.prototype.clearData=function(type){null!=type?delete this._data[type.toLowerCase()]:this._data={}},DataTransfer.prototype.getData=function(type){return this._data[type.toLowerCase()]||""},DataTransfer.prototype.setData=function(type,value){this._data[type.toLowerCase()]=value},DataTransfer.prototype.setDragImage=function(img,offsetX,offsetY){var ddt=DragDropTouch._instance;ddt._imgCustom=img,ddt._imgOffset={x:offsetX,y:offsetY}},DataTransfer}();DragDropTouch_1.DataTransfer=DataTransfer;var DragDropTouch=function(){function DragDropTouch(){if(this._lastClick=0,DragDropTouch._instance)throw"DragDropTouch instance already created.";var supportsPassive=!1;if(document.addEventListener("test",(function(){}),{get passive(){return supportsPassive=!0,!0}}),navigator.maxTouchPoints){var d=document,ts=this._touchstart.bind(this),tm=this._touchmove.bind(this),te=this._touchend.bind(this),opt=!!supportsPassive&&{passive:!1,capture:!1};d.addEventListener("touchstart",ts,opt),d.addEventListener("touchmove",tm,opt),d.addEventListener("touchend",te),d.addEventListener("touchcancel",te)}}return DragDropTouch.getInstance=function(){return DragDropTouch._instance},DragDropTouch.prototype._touchstart=function(e){var _this=this;if(this._shouldHandle(e)){if(Date.now()-this._lastClick<DragDropTouch._DBLCLICK&&this._dispatchEvent(e,"dblclick",e.target))return e.preventDefault(),void this._reset();this._reset();var src=this._closestDraggable(e.target);src&&(this._dispatchEvent(e,"mousemove",e.target)||this._dispatchEvent(e,"mousedown",e.target)||(this._dragSource=src,this._ptDown=this._getPoint(e),this._lastTouch=e,e.preventDefault(),setTimeout((function(){_this._dragSource==src&&null==_this._img&&_this._dispatchEvent(e,"contextmenu",src)&&_this._reset()}),DragDropTouch._CTXMENU),DragDropTouch._ISPRESSHOLDMODE&&(this._pressHoldInterval=setTimeout((function(){_this._isDragEnabled=!0,_this._touchmove(e)}),DragDropTouch._PRESSHOLDAWAIT))))}},DragDropTouch.prototype._touchmove=function(e){if(this._shouldCancelPressHoldMove(e))this._reset();else if(this._shouldHandleMove(e)||this._shouldHandlePressHoldMove(e)){var target=this._getTarget(e);if(this._dispatchEvent(e,"mousemove",target))return this._lastTouch=e,void e.preventDefault();this._dragSource&&!this._img&&this._shouldStartDragging(e)&&(this._dispatchEvent(e,"dragstart",this._dragSource),this._createImage(e),this._dispatchEvent(e,"dragenter",target)),this._img&&(this._lastTouch=e,e.preventDefault(),this._dispatchEvent(e,"drag",this._dragSource),target!=this._lastTarget&&(this._dispatchEvent(this._lastTouch,"dragleave",this._lastTarget),this._dispatchEvent(e,"dragenter",target),this._lastTarget=target),this._moveImage(e),this._isDropZone=this._dispatchEvent(e,"dragover",target))}},DragDropTouch.prototype._touchend=function(e){if(this._shouldHandle(e)){if(this._dispatchEvent(this._lastTouch,"mouseup",e.target))return void e.preventDefault();this._img||(this._dragSource=null,this._dispatchEvent(this._lastTouch,"click",e.target),this._lastClick=Date.now()),this._destroyImage(),this._dragSource&&(e.type.indexOf("cancel")<0&&this._isDropZone&&this._dispatchEvent(this._lastTouch,"drop",this._lastTarget),this._dispatchEvent(this._lastTouch,"dragend",this._dragSource),this._reset())}},DragDropTouch.prototype._shouldHandle=function(e){return e&&!e.defaultPrevented&&e.touches&&e.touches.length<2},DragDropTouch.prototype._shouldHandleMove=function(e){return!DragDropTouch._ISPRESSHOLDMODE&&this._shouldHandle(e)},DragDropTouch.prototype._shouldHandlePressHoldMove=function(e){return DragDropTouch._ISPRESSHOLDMODE&&this._isDragEnabled&&e&&e.touches&&e.touches.length},DragDropTouch.prototype._shouldCancelPressHoldMove=function(e){return DragDropTouch._ISPRESSHOLDMODE&&!this._isDragEnabled&&this._getDelta(e)>DragDropTouch._PRESSHOLDMARGIN},DragDropTouch.prototype._shouldStartDragging=function(e){var delta=this._getDelta(e);return delta>DragDropTouch._THRESHOLD||DragDropTouch._ISPRESSHOLDMODE&&delta>=DragDropTouch._PRESSHOLDTHRESHOLD},DragDropTouch.prototype._reset=function(){this._destroyImage(),this._dragSource=null,this._lastTouch=null,this._lastTarget=null,this._ptDown=null,this._isDragEnabled=!1,this._isDropZone=!1,this._dataTransfer=new DataTransfer,clearInterval(this._pressHoldInterval)},DragDropTouch.prototype._getPoint=function(e,page){return e&&e.touches&&(e=e.touches[0]),{x:page?e.pageX:e.clientX,y:page?e.pageY:e.clientY}},DragDropTouch.prototype._getDelta=function(e){if(DragDropTouch._ISPRESSHOLDMODE&&!this._ptDown)return 0;var p=this._getPoint(e);return Math.abs(p.x-this._ptDown.x)+Math.abs(p.y-this._ptDown.y)},DragDropTouch.prototype._getTarget=function(e){for(var pt=this._getPoint(e),el=document.elementFromPoint(pt.x,pt.y);el&&"none"==getComputedStyle(el).pointerEvents;)el=el.parentElement;return el},DragDropTouch.prototype._createImage=function(e){this._img&&this._destroyImage();var src=this._imgCustom||this._dragSource;if(this._img=src.cloneNode(!0),this._copyStyle(src,this._img),this._img.style.top=this._img.style.left="-9999px",!this._imgCustom){var rc=src.getBoundingClientRect(),pt=this._getPoint(e);this._imgOffset={x:pt.x-rc.left,y:pt.y-rc.top},this._img.style.opacity=DragDropTouch._OPACITY.toString()}this._moveImage(e),document.body.appendChild(this._img)},DragDropTouch.prototype._destroyImage=function(){this._img&&this._img.parentElement&&this._img.parentElement.removeChild(this._img),this._img=null,this._imgCustom=null},DragDropTouch.prototype._moveImage=function(e){var _this=this;requestAnimationFrame((function(){if(_this._img){var pt=_this._getPoint(e,!0),s=_this._img.style;s.position="absolute",s.pointerEvents="none",s.zIndex="999999",s.left=Math.round(pt.x-_this._imgOffset.x)+"px",s.top=Math.round(pt.y-_this._imgOffset.y)+"px"}}))},DragDropTouch.prototype._copyProps=function(dst,src,props){for(var i=0;i<props.length;i++){var p=props[i];dst[p]=src[p]}},DragDropTouch.prototype._copyStyle=function(src,dst){if(DragDropTouch._rmvAtts.forEach((function(att){dst.removeAttribute(att)})),src instanceof HTMLCanvasElement){var cSrc=src,cDst=dst;cDst.width=cSrc.width,cDst.height=cSrc.height,cDst.getContext("2d").drawImage(cSrc,0,0)}for(var cs=getComputedStyle(src),i=0;i<cs.length;i++){var key=cs[i];key.indexOf("transition")<0&&(dst.style[key]=cs[key])}dst.style.pointerEvents="none";for(var i=0;i<src.children.length;i++)this._copyStyle(src.children[i],dst.children[i])},DragDropTouch.prototype._dispatchEvent=function(e,type,target){if(e&&target){var evt=document.createEvent("Event"),t=e.touches?e.touches[0]:e;return evt.initEvent(type,!0,!0),evt.button=0,evt.which=evt.buttons=1,this._copyProps(evt,e,DragDropTouch._kbdProps),this._copyProps(evt,t,DragDropTouch._ptProps),evt.dataTransfer=this._dataTransfer,target.dispatchEvent(evt),evt.defaultPrevented}return!1},DragDropTouch.prototype._closestDraggable=function(e){for(;e;e=e.parentElement)if(e.hasAttribute("draggable")&&e.draggable)return e;return null},DragDropTouch}();DragDropTouch._instance=new DragDropTouch,DragDropTouch._THRESHOLD=5,DragDropTouch._OPACITY=.5,DragDropTouch._DBLCLICK=500,DragDropTouch._CTXMENU=900,DragDropTouch._ISPRESSHOLDMODE=!1,DragDropTouch._PRESSHOLDAWAIT=400,DragDropTouch._PRESSHOLDMARGIN=25,DragDropTouch._PRESSHOLDTHRESHOLD=0,DragDropTouch._rmvAtts="id,class,style,draggable".split(","),DragDropTouch._kbdProps="altKey,ctrlKey,metaKey,shiftKey".split(","),DragDropTouch._ptProps="pageX,pageY,clientX,clientY,screenX,screenY,offsetX,offsetY".split(","),DragDropTouch_1.DragDropTouch=DragDropTouch}(DragDropTouch||(DragDropTouch={}));